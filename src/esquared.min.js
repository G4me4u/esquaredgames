var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6","es3");Array.makeArray=function(a,b){b=void 0===b?null:b;for(var c=[],d=0;d<a;d++)c.push(b);return c};Math.clamp=function(a,b,c){return c<a?a:c>b?b:c};var LEVEL_NONE=0,LEVEL_FATAL=1,LEVEL_ERROR=2,LEVEL_WARN=3,LEVEL_INFO=4,ESLogger=function(){this.level=LEVEL_INFO};ESLogger.prototype.setLevel=function(a){this.level=a};ESLogger.prototype.info=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];this.log.apply(this,[].concat([LEVEL_INFO,"INFO"],$jscomp.arrayFromIterable(b)))};ESLogger.prototype.warn=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];this.log.apply(this,[].concat([LEVEL_WARN,"WARN"],$jscomp.arrayFromIterable(b)))};
ESLogger.prototype.error=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];this.log.apply(this,[].concat([LEVEL_ERROR,"ERROR"],$jscomp.arrayFromIterable(b)))};ESLogger.prototype.fatal=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];this.log.apply(this,[].concat([LEVEL_FATAL,"FATAL"],$jscomp.arrayFromIterable(b)))};ESLogger.prototype.log=function(a,b,c){for(var d=[],e=2;e<arguments.length;++e)d[e-2]=arguments[e];a>this.level||console.log("["+b+"]: "+d.toString())};
var logger=new ESLogger;var ESTimer=function(a,b){this.tps=a;this.debug=void 0===b?!1:b;this.frames=this.ticks=this.ds=this.dt=this.missingTicks=this.last=0};ESTimer.prototype.init=function(){this.last=Date.now();this.missingTicks=0;this.dt=1;this.frames=this.ticks=this.ds=0};ESTimer.prototype.setTps=function(a){this.tps=a};ESTimer.prototype.incrementTps=function(a){this.tps+=a};
ESTimer.prototype.clock=function(){var a=Date.now(),b=(a-this.last)/1E3;this.last=a;this.dt+=b*this.tps;a=Math.floor(this.dt);this.missingTicks+=a;this.dt-=a;this.debug&&(this.ds+=b,1<=this.ds&&(--this.ds,1<=this.ds&&(this.ds=0),logger.info("Tps: "+this.ticks+" Fps: "+this.frames),this.frames=this.ticks=0))};ESTimer.prototype.tickPassed=function(){this.ticks++;this.missingTicks--};ESTimer.prototype.framePassed=function(){this.frames++};
ESTimer.prototype.timeout=function(a,b){var c=Date.now()-this.last;b=this.tps<b?b-b%this.tps:this.tps;b=Math.floor(1E3/(b+1))-c;setTimeout(a,0<b?b:0)};var ESVec2=function(a,b){this.x=void 0===a?0:a;this.y=void 0===b?0:b};ESVec2.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};ESVec2.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};ESVec2.prototype.mul=function(a){this.x*=a.x;this.y*=a.y;return this};ESVec2.prototype.div=function(a){this.x/=a.x;this.y/=a.y;return this};ESVec2.prototype.addXY=function(a,b){this.x+=a;this.y+=b;return this};ESVec2.prototype.subXY=function(a,b){this.x-=a;this.y-=b;return this};
ESVec2.prototype.mulXY=function(a,b){this.x*=a;this.y*=b;return this};ESVec2.prototype.divXY=function(a,b){this.x/=a;this.y/=b;return this};ESVec2.prototype.addC=function(a){this.x+=a;this.y+=a;return this};ESVec2.prototype.subC=function(a){this.x-=a;this.y-=a;return this};ESVec2.prototype.mulK=function(a){this.x*=a;this.y*=a;return this};ESVec2.prototype.divC=function(a){this.x/=a;this.y/=a;return this};ESVec2.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};
ESVec2.prototype.dot=function(a){return this.x*a.x+this.y*a.y};ESVec2.prototype.lengthSqr=function(){return this.dot(this)};ESVec2.prototype.length=function(){return Math.sqrt(this.dot(this))};ESVec2.prototype.set=function(a){this.x=a.x;this.y=a.y;return this};ESVec2.prototype.setXY=function(a,b){this.x=a;this.y=b;return this};ESVec2.prototype.normalize=function(){var a=this.length();this.x/=a;this.y/=a;return this};
ESVec2.prototype.equals=function(a){return a instanceof ESVec2?this.x==a.x&&this.y==a.y:!1};ESVec2.prototype.toString=function(){return this.x+", "+this.y};var ESVec3=function(a,b,c){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c};ESVec3.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};ESVec3.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this};ESVec3.prototype.mul=function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this};ESVec3.prototype.div=function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this};ESVec3.prototype.addXYZ=function(a,b,c){this.x+=a;this.y+=b;this.z+=c;return this};
ESVec3.prototype.subXYZ=function(a,b,c){this.x-=a;this.y-=b;this.z-=c;return this};ESVec3.prototype.mulXYZ=function(a,b,c){this.x*=a;this.y*=b;this.z*=c;return this};ESVec3.prototype.divXYZ=function(a,b,c){this.x/=a;this.y/=b;this.z/=c;return this};ESVec3.prototype.addC=function(a){this.x+=a;this.y+=a;this.z+=a;return this};ESVec3.prototype.subC=function(a){this.x-=a;this.y-=a;this.z-=a;return this};ESVec3.prototype.mulC=function(a){this.x*=a;this.y*=a;this.z*=a;return this};
ESVec3.prototype.divC=function(a){this.x/=a;this.y/=a;this.z/=a;return this};ESVec3.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};ESVec3.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};ESVec3.prototype.lengthSqr=function(){return this.dot(this)};ESVec3.prototype.length=function(){return Math.sqrt(this.dot(this))};ESVec3.prototype.set=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};
ESVec3.prototype.setV2Z=function(a,b){this.x=a.x;this.y=a.y;this.z=b;return this};ESVec3.prototype.setXV2=function(a,b){this.x=a;this.y=b.x;this.z=b.y;return this};ESVec3.prototype.setXYZ=function(a,b,c){this.x=a;this.y=b;this.z=c;return this};ESVec3.prototype.normalize=function(){var a=this.length();this.x/=a;this.y/=a;this.z/=a;return this};ESVec3.prototype.equals=function(a){return a instanceof ESVec3?this.x==a.x&&this.y==a.y&&this.z==a.z:!1};
ESVec3.prototype.toString=function(){return this.x+", "+this.y+", "+this.z};var ESColor=function(a,b,c){this.r=a;this.g=b;this.b=c;this.style="rgb("+this.r+","+this.g+","+this.b+")"};ESColor.prototype.getRed=function(){return this.r};ESColor.prototype.getGreen=function(){return this.g};ESColor.prototype.getBlue=function(){return this.b};ESColor.prototype.getRGB=function(){return this.r<<16|this.g<<8|this.b<<0};
var COLOR_RED=new ESColor(255,0,0),COLOR_GREEN=new ESColor(0,255,0),COLOR_BLUE=new ESColor(0,0,255),COLOR_YELLOW=new ESColor(255,255,0),COLOR_CYAN=new ESColor(0,255,255),COLOR_MAGENTA=new ESColor(255,0,255),COLOR_BLACK=new ESColor(0,0,0),COLOR_WHITE=new ESColor(255,255,255);var ESScreen=function(a,b,c){this.canvas=a;this.ctx=a.getContext("2d");this.width=b;this.height=c;this.pixels=Array.makeArray(b*c,COLOR_BLACK)};ESScreen.prototype.setPixel=function(a,b,c){this.pixels[a+b*this.width]=c?c:COLOR_BLACK};ESScreen.prototype.getPixel=function(a,b){return this.pixels[a+b*this.width]};
ESScreen.prototype.drawToScreen=function(){var a=Math.min(Math.floor(this.canvas.width/this.width),Math.floor(this.canvas.height/this.height))>>1,b=a<<1;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var c=0;c<this.width;c++)for(var d=0;d<this.height;d++){var e=this.getPixel(c,d),f=c*b+a+PIXEL_MARGIN,g=d*b+a+PIXEL_MARGIN;this.ctx.beginPath();this.ctx.arc(f,g,a-PIXEL_MARGIN,0,2*Math.PI,!1);this.ctx.fillStyle=e.style;this.ctx.fill()}};var ESInput=function(a,b){this.name=a;this.control=b;this.wasReleased=this.wasPressed=this.pressed=!1;this.when=-1};ESInput.prototype.setPressed=function(a,b,c){a?this.wasReleased&&b||(this.when=c,this.pressed=!0,this.wasPressed&=b,this.wasReleased=!1):this.wasReleased=!0};ESInput.prototype.update=function(){this.wasPressed=this.pressed;this.wasReleased&&(this.pressed=!1)};ESInput.prototype.clicked=function(){return this.pressed&&!this.wasPressed};
ESInput.prototype.released=function(){return this.wasReleased&&this.pressed};var KEY_MIDDLE=0,KEY_UP=1,KEY_RIGHT=2,KEY_DOWN=3,KEY_LEFT=4,ESController=function(){this.codeToControl={32:KEY_MIDDLE,38:KEY_UP,39:KEY_RIGHT,40:KEY_DOWN,37:KEY_LEFT};this.controls={0:new ESInput("middle",KEY_MIDDLE),1:new ESInput("up",KEY_UP),2:new ESInput("right",KEY_RIGHT),3:new ESInput("down",KEY_DOWN),4:new ESInput("left",KEY_LEFT)};this.events=[]};
ESController.prototype.update=function(){for(var a in this.controls)this.controls[a].update();for(;0<this.events.length;)a=this.events.pop(0),this.controls[a.control].setPressed(a.pressed,a.repeat,a.when)};ESController.prototype.handleEvent=function(a,b){a.keyCode in this.codeToControl&&this.events.push({control:this.codeToControl[a.keyCode],pressed:b,repeat:a.repeat,when:Date.now()})};ESController.prototype.getInput=function(a){return this.controls[a]};
ESController.prototype.getLatestInput=function(){var a=null,b=-1,c;for(c in this.controls){var d=this.controls[c];d.when>b&&(a=d,b=d.when)}return a};var ESCursor=function(a,b,c){this.app=a;this.color=b;this.cursorToggleTime=c;this.controls=[KEY_UP,KEY_RIGHT,KEY_DOWN,KEY_LEFT];this.dirs=[new ESVec2(0,-1),new ESVec2(1,0),new ESVec2(0,1),new ESVec2(-1,0)];this.x=WIDTH>>1;this.y=HEIGHT>>1;this.cursTimer=0};ESCursor.prototype.setPos=function(a,b){this.x=Math.clamp(0,WIDTH-1,a);this.y=Math.clamp(0,HEIGHT-1,b)};
ESCursor.prototype.update=function(){for(var a=0;a<this.controls.length;a++)if(this.app.controller.getInput(this.controls[a]).clicked()){a=this.dirs[a];this.x=Math.clamp(0,WIDTH-1,this.x+a.x);this.y=Math.clamp(0,HEIGHT-1,this.y+a.y);this.cursTimer=0;break}this.cursTimer++};ESCursor.prototype.render=function(){this.cursTimer%this.cursorToggleTime<this.cursorToggleTime>>1&&this.app.setPixel(this.x,this.y,this.color)};var ESDirection=function(a,b,c,d,e){this.name=a;this.id=b;this.opp=c;this.cw=d;this.ccw=e};ESDirection.prototype.getOpposite=function(){return directions[this.opp]};ESDirection.prototype.rotateCW=function(){return directions[this.cw]};ESDirection.prototype.rotateCCW=function(){return directions[this.ccw]};
var DIR_UP=new ESDirection("up",0,2,1,3),DIR_RIGHT=new ESDirection("right",1,3,2,0),DIR_DOWN=new ESDirection("down",2,0,3,1),DIR_LEFT=new ESDirection("left",3,1,0,2),directions=[DIR_UP,DIR_RIGHT,DIR_DOWN,DIR_LEFT];var ENTITY_UNDEFINED=0,ESEntity=function(a,b,c,d,e){e=void 0===e?ENTITY_UNDEFINED:e;this.world=a;this.pos=new ESVec2(b,c);this.color=d;this.type=e;this.dead=!1};ESEntity.prototype.update=function(){(0>this.pos.x||this.pos.x>=WIDTH)&&this.setDead();(0>this.pos.y||this.pos.y>=HEIGHT)&&this.setDead()};ESEntity.prototype.collides=function(a){return this.pos.equals(a.pos)};ESEntity.prototype.setDead=function(){this.dead=!0};var ESTile=function(){};ESTile.prototype.getColor=function(){return COLOR_BLACK};ESTile.prototype.render=function(a,b,c){var d=this.getColor();null!=d&&a.setPixel(b,c,d)};var ESWorld=function(a){this.app=a;this.entities=null;this.wonGame=this.gameOver=!1;this.time=0;this.gameOverAnim=4;this.reset()};ESWorld.prototype.reset=function(){this.entities=[];this.wonGame=this.gameOver=!1;this.time=0;this.gameOverAnim=4};ESWorld.prototype.setGameOver=function(a){this.gameOver=!0;this.wonGame=a};ESWorld.prototype.addEntity=function(a){this.entities.push(a)};ESWorld.prototype.removeEntity=function(a){for(var b=this.entities.length,c=0;c<b;c++)this.entities[c]==a&&this.entities.pop(c)};
ESWorld.prototype.isColliding=function(a,b){b=void 0===b?ENTITY_UNDEFINED:b;for(var c=b==ENTITY_UNDEFINED,d=$jscomp.makeIterator(this.entities),e=d.next();!e.done;e=d.next())if(e=e.value,(c||e.type==b)&&e.collides(a))return e;return null};ESWorld.prototype.renderEntity=function(a){this.app.setPixel(a.pos.x,a.pos.y,a.color)};ESWorld.prototype.update=function(){this.time++;if(!this.gameOver)for(var a=this.entities.length-1;0<=a;){var b=this.entities[a];b.update();b.dead?this.entities.pop(a):a--}};
ESWorld.prototype.renderGame=function(){for(var a=$jscomp.makeIterator(this.entities),b=a.next();!b.done;b=a.next())this.renderEntity(b.value)};ESWorld.prototype.renderGameOver=function(){this.time%this.gameOverAnim>=this.gameOverAnim>>1||this.app.clear(this.wonGame?COLOR_GREEN:COLOR_RED)};ESWorld.prototype.render=function(){this.gameOver?this.renderGameOver():this.renderGame()};var ESTileWorld=function(a){ESWorld.call(this,a)};$jscomp.inherits(ESTileWorld,ESWorld);ESTileWorld.prototype.reset=function(){ESWorld.prototype.reset.call(this);this.initTiles()};ESTileWorld.prototype.initTiles=function(){this.tiles=[];for(var a=WIDTH*HEIGHT;this.tiles.length<a;)this.tiles.push(this.createTile())};ESTileWorld.prototype.createTile=function(){return new ESTile};ESTileWorld.prototype.getTile=function(a,b){return 0>a||a>=WIDTH||0>b||b>=HEIGHT?null:this.tiles[a+b*WIDTH]};
ESTileWorld.prototype.setTile=function(a,b,c){if(0>a||a>=WIDTH||0>b||b>=HEIGHT)return!1;this.tiles[a+b*WIDTH]=c;return!0};ESTileWorld.prototype.renderGame=function(){for(var a=0,b=0;b<HEIGHT;b++)for(var c=0;c<WIDTH;c++)this.tiles[a++].render(this.app,c,b)};var DEBUG=!0,WIDTH=8,HEIGHT=8,PIXEL_MARGIN=2,TPS=20,FPS=60;var ESApp=function(){this.controller=this.screen=this.timer=null;this.running=!1};
ESApp.prototype.init=function(){var a=this,b=document.getElementById("screen");if(!b)return logger.fatal("Canvas not found! Make sure it has id: screen"),!1;this.timer=new ESTimer(TPS,DEBUG);this.screen=new ESScreen(b,WIDTH,HEIGHT);this.controller=new ESController;document.addEventListener("keydown",function(b){return a.controller.handleEvent(b,!0)});document.addEventListener("keyup",function(b){return a.controller.handleEvent(b,!1)});return!0};
ESApp.prototype.start=function(){logger.info("Launching...");if(!this.init())throw"Unable to launch";logger.info("Launch successful!");this.running=!0;this.timer.init();this.loop()};ESApp.prototype.loop=function(){var a=this;if(this.running){for(this.timer.clock();0<this.timer.missingTicks;)this.controller.update(),this.update(),this.timer.tickPassed();this.clear();this.render();this.screen.drawToScreen();this.timer.framePassed();this.timer.timeout(function(){return a.loop()},FPS)}};
ESApp.prototype.setPixel=function(a,b,c){this.screen.setPixel(a,b,c)};ESApp.prototype.clear=function(a){a=void 0===a?COLOR_BLACK:a;for(var b=0;b<HEIGHT;b++)for(var c=0;c<WIDTH;c++)this.setPixel(c,b,a)};ESApp.prototype.setTps=function(a){a=void 0===a?DEFAULT_TPS:a;this.timer.setTps(a)};ESApp.prototype.incrementTps=function(a){this.timer.incrementTps(a)};ESApp.prototype.update=function(){};ESApp.prototype.render=function(){};
